# レイテンシ・帯域幅入門

## スピードは機能

ネットワークトラフィックのパフォーマンスを左右する2つの重要な要素に焦点を当てて説明する。

- レイテンシ(lataency): 送信元がパケットを送信してから宛先が受信するまでの時間
- 帯域幅(bandwidth): 論理的、もしくは物理的通信路に置ける最大スループット

```
帯域幅はその経路に置ける理論的な最大通信速度のことで、スループットは実効速度です。
```

## レイテンシを構成する多数の構成要素

レイテンシはパケットが送信元から送られて宛先まで届く時間です。

### ルータに置いて時間を消費するいくつかの一般的な構成要素

- 伝搬遅延
  - メッセージが送信元から宛先まで移動するためにかかる時間。距離を信号の伝搬速度で割ったもの。
- 伝送遅延
  - パケットの全ビットをリンクに載せるまでにかかる時間。パケット長とリンクのデータ転送速度の関数。
- 処理遅延
  - パケットヘッダの処理、ビットレベルのエラー検知、パケットの宛先決定にかかる時間。
- キューイング遅延
  - パケットが処理できる状態になる前にキューで待機する時間。

## 光の速さと伝搬遅延

遅れが300msを越えると `反応が鈍い` 

1000msを越えると `ユーザーの意識が切り替わってしまう`

アプリケーションは少なくとも数百msの間にレスポンスを返さなければいけない。

```
CDN
地球上に配信されたコンテンツを地理的にクライアントに近い場所から配信すること。
パケットの伝搬時間を大幅に削減できる
```

## ラストマイルのレイテンシ

大幅なレイテンシが発生するのは多くの場合、海や大陸をわたる時ではなく最後の数マイルです。
このことをラストマイル問題と呼ぶ。

自宅やおフィルからインターネットに接続するためにISP(internet service provider)は町内の隅々までケーブルをめぐらせ、信号を集めて、ローカルのルーティングノードに送ります。
ISPのメインルータまでの最初の数ホップに数十msもかかってしまう可能性があります。

tracerouteコマンドを実効するとISPのトポロジとパフォーマンスを教えてくれる。

```
WDM
光ファイバの両端に接続されている機器。
多重送信技術をもつ。
```

## より大きな帯域幅とより低いレイテンシを提供

最小のレイテンシは光の速さであり、これを乗り越える手段はない。

光を越える速度で移動させることはできないが、代わり距離を縮めることはできる。

```
アプリケーションのパフォーマンスを向上させるためには
帯域幅と光の速さの限界を認識した上でプロトコルとネットワーキングのコードを構築し最適化を行わなければならない
パケットの無駄な往復を減らし、キャッシュやプリフェッチなどの技術によってレイテンシを隠蔽できるアプリケーションを構築する必要がある。
```

