# 第３章 コードの不吉な匂い

リファクタリングを行うべきタイミングを匂いで表す。

## 不可思議な名前

関数、モジュール、変数、クラスなどの名前について、行なっていることや利用方法がはっきりと伝わるように懸命に考える。

- 関数宣言の変更
- 変数名の変更
- フィールド名の変更

## 重複したコード

重複部分を修正する場合は、重複部分を漏れなく見つけ、全てを同様に修正を施していく必要がある。
これはバグの温床になるので、一箇所にまとめる必要がある。

- 関数の抽出
- ステートメントのスライド: 類似コードを一つのところにまとめ、抽出しやすくする。
- メソッドの引き上げ: サブクラス間に重複したコードがある場合は、スーパークラスにまとめる。

## 長い関数

関数は長くなれば、長くなるほどわかりにくくなる。
しかし、関数の抽出を行うと関数を次から次へと追っていかねばなず、依然としてある種のオーバーヘッドがかかる。
そこで関数名を意識し、適切な名前をつけてあげれば、内部の実装をみることなく、先に読み進めていくことができる。

### 関数を減らす方法

- 関数の抽出: 人つにまとめられそうな箇所があったら迷わずまとめる

### パラメータリストを減らす

- 問い合わせによる一時変数の置き換え: パラメータや一時変数を次々と受け渡さないように、一時変数を減らす。
- パラメータオブジェクトの導入: パラメータリストを減らす
- オブジェクトそのものの受け渡し: パラメータリストを減らす
- コマンドによる関数の置き換え: 一時変数やパラメータを減らす強力な武器。

### 条件分岐やループの抽出

- 条件記述の分解
- 関数の抽出: 巨大なswitch文にも使える
- ポリモーフィズムによる条件記述の置き換え: 同じ条件で分岐しているswitch文が複数あった場合
- ループの分離: ループ部分とループ内部でコードを抽出することができる。

### 関数の名付け方

関数の名前をつけるときは、内部でどのような処理をしているのかではなく、そのコードが何をするのかという `意図`を示した名前をつけるようにします。

たとえコードが長くなってしまったとしても、意図が伝われば良しとする。

## 長いパラメータリスト

長いパラメータリストは混乱の元となるし、かといってグローバル変数もを使うのも同様に混乱の元となる。

- 問い合わせによるパラメータの置き換え: パラメータで渡されるオブジェクトに問い合わせる
- オブジェクトそのものの受け渡し: 元々のデータ構造をわたす
- フラグパラメータの削除: パラメータが振る舞いを変えるためのフラグとして使われている場合
- 関数群のクラスへの集約: 複数の関数が、パラメータで渡される値を共有しているときに使う。

## グローバルなデータ

どこからでも変更可能なデータはデータの汚染を生むので防ぐ。

- 変数のカプセル化

そのあとクラスやモジュール内部に移動させることで、直接参照できる箇所を限定して、スコープをできるだけ狭めてあげるのが良いでしょう。

## 変更不可なデータ

データの変更はしばしば予期せぬ結果や、厄介なバグを引き起こす。

バグを見つけにくい。関数型プログラミング言語は変数の値が変わることを禁じている。
しかし、関数型プログラミングはプログラミングの世界では比較的少数派で、大抵の開発者は変数の値が変わることを
